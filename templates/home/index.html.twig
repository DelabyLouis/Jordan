{% extends 'base.html.twig' %}

{% block title %}Accueil - Boutique{% endblock %}

{% block body %}
<div class="container-fluid">
    <!-- Header Section -->
    <div class="hero-section">
        <div class="container">
            <h1>Bienvenue dans notre boutique</h1>
            <p>DÃ©couvrez notre collection de vÃªtements et baskets tendance</p>
        </div>
    </div>

    <div class="container">
        <!-- Filter Section -->
        <div class="filter-section">
            <div class="btn-group">
                <a href="{{ path('app_home') }}" 
                   class="btn {{ current_type is null ? 'btn-red' : '' }}">
                    Tous les produits
                </a>
                <a href="{{ path('app_home', {type: 'vÃªtements'}) }}" 
                   class="btn {{ current_type == 'vÃªtements' ? 'btn-red' : '' }}">
                    VÃªtements
                </a>
                <a href="{{ path('app_home', {type: 'baskets'}) }}" 
                   class="btn {{ current_type == 'baskets' ? 'btn-red' : '' }}">
                    Baskets
                </a>
            </div>
        </div>

        <!-- Products Section -->
        {% if products %}
            <div class="products-grid">
                {% for product in products %}
                    <div class="product-card">
                        <div class="image-placeholder">
                            ðŸ“·
                        </div>
                        <h5>{{ product.name }}</h5>
                        <p>Type: {{ product.type|capitalize }}</p>
                        <p>Stock: {{ product.quantity }}</p>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="product-price">{{ product.price|number_format(2, ',', ' ') }} â‚¬</span>
                        </div>
                        {% if product.quantity > 0 %}
                            <button class="btn btn-red btn-w-full btn-add-to-cart" 
                                    data-product-id="{{ product.id }}">
                                Ajouter au panier
                            </button>
                        {% else %}
                            <button class="btn btn-w-full" disabled>
                                Rupture de stock
                            </button>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-cart">
                <h3>Aucun produit trouvÃ©</h3>
                <p>Essayez de modifier vos filtres ou revenez plus tard.</p>
                <a href="{{ path('app_home') }}" class="btn btn-red">Voir tous les produits</a>
            </div>
        {% endif %}
    </div>
</div>

<!-- Toast notification pour ajout panier -->
<div class="toast-container">
    <div id="cartToast" class="toast">
        <div class="toast-header">
            <strong>Panier</strong>
            <button type="button" class="toast-close" onclick="hideToast()">&times;</button>
        </div>
        <div class="toast-body" id="toastMessage">
            Produit ajoutÃ© au panier avec succÃ¨s !
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        // Ajout au panier
        document.addEventListener('DOMContentLoaded', function() {
            const addToCartButtons = document.querySelectorAll('.btn-add-to-cart');
            
            addToCartButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const productId = this.getAttribute('data-product-id');
                    
                    // Animation du bouton
                    this.innerHTML = 'Ajout...';
                    this.disabled = true;
                    
                    // RequÃªte AJAX pour ajouter au panier
                    fetch(`/cart/add/${productId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: 'quantity=1'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            this.innerHTML = 'AjoutÃ© !';
                            showToast(data.message);
                            updateCartCount();
                            
                            // Remettre le bouton Ã  son Ã©tat initial aprÃ¨s 2 secondes
                            setTimeout(() => {
                                this.innerHTML = 'Ajouter au panier';
                                this.classList.add('btn-red');
                                this.disabled = false;
                            }, 2000);
                        } else {
                            this.innerHTML = 'Erreur';
                            showToast(data.message);
                            
                            setTimeout(() => {
                                this.innerHTML = 'Ajouter au panier';
                                this.disabled = false;
                            }, 2000);
                        }
                    })
                    .catch(error => {
                        console.error('Erreur:', error);
                        this.innerHTML = 'Erreur';
                        this.disabled = false;
                    });
                });
            });
        });
        
        function showToast(message) {
            document.getElementById('toastMessage').textContent = message;
            document.getElementById('cartToast').classList.add('show');
            setTimeout(() => {
                document.getElementById('cartToast').classList.remove('show');
            }, 3000);
        }
        
        function hideToast() {
            document.getElementById('cartToast').classList.remove('show');
        }
    </script>
{% endblock %}
